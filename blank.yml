name: American8       # Nom du workflow (apparaît dans GitHub Actions)

# Déclencheurs du workflow - mot clé "on"
on:
  push:                    # Quand on push sur le dépôt. Pas de branches spécifiées, donc agit sur tout type de push
  pull_request:            # Quand une pull request est ouverte ou mise à jour

jobs:                      # Début de la liste des jobs
  build:                   # Nom du job
    runs-on: ubuntu-latest # Machine virtuelle Ubuntu utilisée

    steps:                 # Liste des étapes
      # --- Étape 1 : Récupérer le code ---
      - name: Checkout repository
        uses: actions/checkout@v3
        # "uses" indique qu'on utilise une action existante depuis GitHub Marketplace
        # Ici, checkout permet de récupérer le code du dépôt pour l'exécuter

      # --- Étape 2 : Installer Java (JDK) ---
      - name: Set up JDK   #A voir pour l'utilisaton de Java 21
        uses: actions/setup-java@v3
        with:
          distribution: temurin  # La distribution du JDK, classique
          java-version: '17'    # La version Java à utiliser
        # Cela installe Java sur la machine virtuelle pour que Gradle puisse fonctionner

      # --- Étape 3 : Installer Gradle (optionnel si tu as le wrapper) ---
      # Si tu as le wrapper Gradle (gradlew), tu peux sauter cette étape
      # Sinon tu peux installer Gradle via une action
      # - name: Setup Gradle
      #   uses: gradle/gradle-build-action@v2
      #   with:
      #     gradle-version: '8.2'

      # --- Étape 4 : Build du projet ---
      - name: Build with Gradle
        run: ./gradlew build
        # "run" permet d'exécuter une commande shell sur la machine virtuelle
        # Ici, gradlew build compile le projet et assemble les fichiers

      # --- Étape 5 : Lancer les tests ---
      - name: Run tests
        run: ./gradlew test
        # Exécute tous les tests unitaires définis dans le projet

      # --- Étape 6 : Vérifier la qualité du code ---
      - name: Check code quality
        run: ./gradlew check
        # "check" inclut souvent des plugins comme Checkstyle ou SpotBugs si configurés

      # --- Étape 7 : Optionnel : publier un rapport ---
      - name: Show test results
        run: cat build/test-results/test/*.xml
        # Affiche les résultats de test dans les logs GitHub Actions

      - name: Cache Gradle packages
        uses: actions/cache@v3
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: gradle-${{ runner.os }}-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}

